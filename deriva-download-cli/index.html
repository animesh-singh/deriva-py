<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Bulk export tool (deriva-download-cli) - deriva-py Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Bulk export tool (deriva-download-cli)";
    var mkdocs_page_input_path = "deriva-download-cli.md";
    var mkdocs_page_url = "/deriva-download-cli/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> deriva-py Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">deriva-py Documentation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Docs</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../install/">Installing deriva-py</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Bulk export tool (deriva-download-cli)</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#deriva-download-cli">deriva-download-cli</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#features">Features</a></li>
        
            <li><a class="toctree-l4" href="#command-line-options">Command-Line options</a></li>
        
            <li><a class="toctree-l4" href="#configuration-file-format">Configuration file format</a></li>
        
            <li><a class="toctree-l4" href="#supported-output-formats">Supported output formats</a></li>
        
            <li><a class="toctree-l4" href="#output-format-details">Output format details</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../deriva-hatrac-cli/">Interact with Hatrac object store (deriva-hatrac-cli)</a>
                </li>
                <li class="">
                    
    <a class="" href="../deriva-acl-config/">Configure ACLs (deriva-acl-config)</a>
                </li>
                <li class="">
                    
    <a class="" href="../deriva-annotation-config/">Configure annotations (deriva-annotation-config)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../api/">API Docs</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">deriva-py Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>User Docs &raquo;</li>
        
      
    
    <li>Bulk export tool (deriva-download-cli)</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="deriva-download-cli">deriva-download-cli<a class="headerlink" href="#deriva-download-cli" title="Permanent link">&para;</a></h1>
<p>The <code>deriva-download-cli</code> is a command-line utility for orchestrating the bulk export of tabular data 
(stored in ERMRest) and download of asset data (stored in Hatrac, or other supported HTTP-accessible object store).
It supports the transfer of data directly to local filesystems, or packaging results into the
<a href="https://en.wikipedia.org/wiki/BagIt"><code>bagit</code></a> container format.  The program is driven by the combined
usage of command-line arguments and a JSON-based configuration ("spec") file, which contains the processing
directives used to orchestrate the creation of the result data set.</p>
<h2 id="features">Features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h2>
<ul>
<li>Transfer both tabular data and file assets from Deriva catalogs.</li>
<li>Create <code>bag</code> containers, which may reference files stored in remote locations.</li>
<li>Supports an extensible processing pipeline whereby data may be run through transform functions
or other arbitrary processing before final result packaging.</li>
</ul>
<h2 id="command-line-options">Command-Line options<a class="headerlink" href="#command-line-options" title="Permanent link">&para;</a></h2>
<pre><code>usage: deriva-download-cli.py [-h] [--version] [--quiet] [--debug]
                              [--credential-file &lt;file&gt;] [--catalog &lt;1&gt;]
                              [--token &lt;auth-token&gt;]
                              &lt;host&gt; &lt;config file&gt; &lt;output dir&gt; ...

Deriva Data Download Utility - CLI

positional arguments:
  &lt;host&gt;                Fully qualified host name.
  &lt;config file&gt;         Path to a configuration file.
  &lt;output dir&gt;          Path to an output directory.
  [key=value key=value ...]
                        Variable length of whitespace-delimited key=value pair
                        arguments used for string interpolation in specific
                        parts of the configuration file. For example:
                        key1=value1 key2=value2

optional arguments:
  -h, --help            show this help message and exit
  --version             Print version and exit.
  --quiet               Suppress logging output.
  --debug               Enable debug logging output.
  --credential-file &lt;file&gt;
                        Optional path to a credential file.
  --catalog &lt;1&gt;         Catalog number. Default: 1
  --token &lt;auth-token&gt;  Authorization bearer token.
</code></pre>

<h3 id="positional-arguments">Positional arguments:<a class="headerlink" href="#positional-arguments" title="Permanent link">&para;</a></h3>
<h4 id="host"><code>&lt;host&gt;</code><a class="headerlink" href="#host" title="Permanent link">&para;</a></h4>
<p>All operations are performed with respect to a specific host and most hosts will
require authentication. If the <code>--host HOSTNAME</code> option is not given, <code>localhost</code> will be assumed.</p>
<h4 id="config-file"><code>&lt;config file&gt;</code><a class="headerlink" href="#config-file" title="Permanent link">&para;</a></h4>
<p>A path to a configuration file is required.  The format and syntax of the file is described <a href="#configuration_file">below</a></p>
<h4 id="output-dir"><code>&lt;output dir&gt;</code><a class="headerlink" href="#output-dir" title="Permanent link">&para;</a></h4>
<p>A path to a output base directory is required. This can be an absolute path or a path relative to the current working directory.</p>
<h3 id="optional-arguments">Optional arguments:<a class="headerlink" href="#optional-arguments" title="Permanent link">&para;</a></h3>
<h4 id="-token"><code>--token</code><a class="headerlink" href="#-token" title="Permanent link">&para;</a></h4>
<p>The CLI accepts an authentication token with the <code>--token TOKEN</code> option. If this
option is not given, it will look in the user home dir where the <code>DERIVA-Auth</code>
client would store the credentials.</p>
<h4 id="-credential-file"><code>--credential-file</code><a class="headerlink" href="#-credential-file" title="Permanent link">&para;</a></h4>
<p>If <code>--token</code> is not specified, the program will look in the user home dir where the <code>DERIVA-Auth</code>
client would store the credentials.  Use the <code>--credential file</code> argument to override this behavior and specify an alternative credential file.</p>
<h4 id="-catalog"><code>--catalog</code><a class="headerlink" href="#-catalog" title="Permanent link">&para;</a></h4>
<p>The catalog number (or path specifier). Defaults to 1.
<a name="configuration_file"></a></p>
<h2 id="configuration-file-format">Configuration file format<a class="headerlink" href="#configuration-file-format" title="Permanent link">&para;</a></h2>
<p>The configuration JSON file (or "spec") is the primary mechanism for orchestrating the export and download of data for a given host.
There are three primary objects that comprise the configuration spec; the <code>catalog</code> element, the <code>env</code> element, and the <code>bag</code> element.</p>
<p>The <code>catalog</code> object is a REQUIRED element, and is principally composed of an array named <code>queries</code> which is a set of configuration stanzas,
executed in declared order, that individually describe <em>what</em> data to retrieve, <em>how</em> the data should be processed, and <em>where</em>
the result data should be placed in the target filesystem.</p>
<p>The <code>env</code> object is an OPTIONAL element which, if present, is expected to be a dictionary of key-value pairs that are available to use as
interpolation variables for various keywords in the <code>queries</code> section of the configuration file.  The string substitution is performed using the keyword
interpolation syntax of Python <a href="https://docs.python.org/2/library/stdtypes.html#str.format"><code>str.format</code></a>.  NOTE: when specifying arbitrary
key-value pairs on the command-line, such pairs will OVERRIDE any matching keys found in the <code>env</code> element of the configuration file.</p>
<p>The <code>bag</code> object is an OPTIONAL element which, if present, declares that the aggregate output from all configuration stanzas listed in the
<code>catalog:queries</code> array should be packaged as a <a href="ttps://en.wikipedia.org/wiki/BagIt"><code>bagit</code></a> formatted container.  The <code>bag</code> element contains
various optional parameters which control bag creation specifics.</p>
<p>Example configuration file:</p>
<pre><code class="json">{
  &quot;env&quot;: {
    &quot;accession&quot;: &quot;XYZ123&quot;,
    &quot;term&quot;: &quot;Chip-seq&quot;
  },
  &quot;bag&quot;: {
    &quot;bag_name&quot;: &quot;test-bag&quot;,
    &quot;bag_archiver&quot;: &quot;zip&quot;,
    &quot;bag_metadata&quot;: {
      &quot;Source-Organization&quot;: &quot;USC Information Sciences Institute, Informatics Systems Research Division&quot;
    }
  },
  &quot;catalog&quot;: {
    &quot;queries&quot;: [
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=RNA%20expression%20%28RNA-seq%29/$E/STRAND:=vocabulary:strandedness/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:accession,experiment:=E:RID,biosample:=SAMPLE:RID,replicate:=R:RID,bioreplicate_num:=R:bioreplicate_number,techreplicate_num:=R:technical_replicate_number,species:=SPEC:term,paired:=PAIRED:term,stranded:=STRAND:term,read:=SEQ:read,file:=SEQ:RID,filename:=SEQ:filename,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{accession}/{accession}-RNA-Seq&quot;,
        &quot;output_format&quot;: &quot;csv&quot;
      },
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=RNA%20expression%20%28RNA-seq%29/$E/STRAND:=vocabulary:strandedness/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:RID,experiment:=E:RID,biosample:=SAMPLE:RID,file:=SEQ:RID,filename:=SEQ:filename,size:=SEQ:byte_count,md5:=SEQ:md5,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{dataset}/{experiment}/{biosample}/seq&quot;,
        &quot;output_format&quot;: &quot;download&quot;
      },
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=Chip-seq/$E/TARGET:=vocabulary:target_of_assay/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:accession,experiment:=E:RID,control:=E:control_assay,biosample:=SAMPLE:RID,replicate:=R:RID,bioreplicate_num:=R:bioreplicate_number,technical_replicate_num:=R:technical_replicate_number,species:=SPEC:term,target:=TARGET:term,paired:=PAIRED:term,read:=SEQ:read,file:=SEQ:RID,filename:=SEQ:filename,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{accession}/{accession}-ChIP-Seq&quot;,
        &quot;output_format&quot;: &quot;csv&quot;
      },
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=Chip-seq/$E/TARGET:=vocabulary:target_of_assay/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:accession,experiment:=E:RID,biosample:=SAMPLE:RID,technical_replicate_num:=R:technical_replicate_number,file:=SEQ:RID,filename:=SEQ:filename,size:=SEQ:byte_count,md5:=SEQ:md5,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{dataset}/{experiment}/{biosample}/seq&quot;,
        &quot;output_format&quot;: &quot;fetch&quot;
      }
    ]
  }
}
</code></pre>

<h4 id="configuration-file-element-catalog">Configuration file element: <code>catalog</code><a class="headerlink" href="#configuration-file-element-catalog" title="Permanent link">&para;</a></h4>
<p>Example:</p>
<pre><code class="json">  &quot;catalog&quot;: {
    &quot;queries&quot;: [
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=Chip-seq/$E/TARGET:=vocabulary:target_of_assay/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:accession,experiment:=E:RID,control:=E:control_assay,biosample:=SAMPLE:RID,replicate:=R:RID,bioreplicate_num:=R:bioreplicate_number,technical_replicate_num:=R:technical_replicate_number,species:=SPEC:term,target:=TARGET:term,paired:=PAIRED:term,read:=SEQ:read,file:=SEQ:RID,filename:=SEQ:filename,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{accession}/{accession}-ChIP-Seq&quot;,
        &quot;output_format&quot;: &quot;csv&quot;
      },
      {
        &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=Chip-seq/$E/TARGET:=vocabulary:target_of_assay/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:accession,experiment:=E:RID,biosample:=SAMPLE:RID,technical_replicate_num:=R:technical_replicate_number,file:=SEQ:RID,filename:=SEQ:filename,size:=SEQ:byte_count,md5:=SEQ:md5,url:=SEQ:url&quot;,
        &quot;output_path&quot;: &quot;{dataset}/{experiment}/{biosample}/seq&quot;,
        &quot;output_format&quot;: &quot;fetch&quot;
      }
    ]
  }
</code></pre>

<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Parent Object</th>
<th>Parameter</th>
<th>Description</th>
<th>Interpolatable</th>
</tr>
</thead>
<tbody>
<tr>
<td>root</td>
<td><em>catalog</em></td>
<td>This is the parent object for all catalog related parameters.</td>
<td>No</td>
</tr>
<tr>
<td><em>catalog</em></td>
<td><em>queries</em></td>
<td>This is an array of objects representing a list of <code>ERMRest</code> queries and the logical outputs of these queries. The logical outputs of each query are then in turn processed by an <em>output format processor</em>, which can either be one of a set of default processors, or an external class conforming to a specified interface.</td>
<td>No</td>
</tr>
<tr>
<td><em>queries</em></td>
<td><em>query_path</em></td>
<td>This is string representing the actual <code>ERMRest</code> query path to be used in the HTTP(S) GET request. It SHOULD already be percent-encoded per <a href="https://tools.ietf.org/html/rfc3986#section-2.1">RFC 3986</a> if it contains any characters outside of the unreserved set.</td>
<td>Yes</td>
</tr>
<tr>
<td><em>queries</em></td>
<td><em>output_path</em></td>
<td>This is a POSIX-compliant path fragment indicating the target location of the retrieved data relative to the specified base download directory.</td>
<td>Yes</td>
</tr>
<tr>
<td><em>queries</em></td>
<td><em>output_format</em></td>
<td>This is a string value used to select from one of the built-in output processor formats. Valid values are <code>env</code>, <code>csv</code>, <code>json</code>, <code>json-stream</code>, <code>download</code>, or <code>fetch</code>.</td>
<td>No</td>
</tr>
<tr>
<td><em>queries</em></td>
<td><em>output_format_params</em></td>
<td>A JSON object of arbitrary complexity containing format-specific processing instructions that will be passed to the <code>output_format_processor</code> instance to be used. This is a context-specific parameter, i.e., this parameter MAY be required for a given <code>output_format_processor</code>, otherwise it can be omitted.</td>
<td>No</td>
</tr>
<tr>
<td><em>queries</em></td>
<td><em>output_format_processor</em></td>
<td>A fully qualified Python class name declaring an external processor class instance to use. If this parameter is present, it OVERRIDES the value (if specified) in <code>output_format</code>. This class MUST be derived from the base class <code>deriva.transfer.download.processors.BaseDownloadProcessor</code>. For example, <code>"output_processor": "deriva.transfer.download.processors.CSVDownloadProcessor"</code>.</td>
<td>No</td>
</tr>
</tbody>
</table>
<h4 id="configuration-file-element-bag">Configuration file element: <code>bag</code><a class="headerlink" href="#configuration-file-element-bag" title="Permanent link">&para;</a></h4>
<p>Example:</p>
<pre><code class="json">&quot;bag&quot;: {
    &quot;bag_name&quot;: &quot;test-bag&quot;,
    &quot;bag_archiver&quot;: &quot;zip&quot;,
    &quot;bag_algorithms&quot;: [&quot;sha256&quot;],
    &quot;bag_metadata&quot;: {
        &quot;Source-Organization&quot;: &quot;USC Information Sciences Institute, Informatics Systems Research Division&quot;
    }
}
</code></pre>

<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Parent Object</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>root</td>
<td><em>bag</em></td>
<td>This is the parent object for all bag-related defaults.</td>
</tr>
<tr>
<td><em>bag</em></td>
<td><em>bag_algorithms</em></td>
<td>This is an array of strings representing the default checksum algorithms to use for bag manifests, if not otherwise specified.  Valid values are "md5", "sha1", "sha256", and "sha512".</td>
</tr>
<tr>
<td><em>bag</em></td>
<td><em>bag_archiver</em></td>
<td>This is a string representing the default archiving format to use if not otherwise specified.  Valid values are "zip", "tar", and "tgz".</td>
</tr>
<tr>
<td><em>bag</em></td>
<td><em>bag_metadata</em></td>
<td>This is a list of simple JSON key-value pairs that will be written as-is to bag-info.txt.</td>
</tr>
</tbody>
</table>
<h4 id="configuration-file-element-env">Configuration file element: <code>env</code><a class="headerlink" href="#configuration-file-element-env" title="Permanent link">&para;</a></h4>
<p>Example:</p>
<pre><code class="json">&quot;env&quot;: {
    &quot;accession&quot;: &quot;XYZ123&quot;,
    &quot;term&quot;: &quot;Chip-seq&quot;
}
</code></pre>

<p>Parameters:</p>
<table>
<thead>
<tr>
<th>Parent Object</th>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>root</td>
<td><em>env</em></td>
<td>This is the parent object for all global "environment" variables. Note that the usage of <em>"env"</em> in this case does not refer to the set of OS environment variables, but rather a combination of key-value pairs from the JSON configuration file and CLI arguments.</td>
</tr>
<tr>
<td><em>env</em></td>
<td><em>[any, 0-N]</em></td>
<td>Any number of arguments of the form <code>key:value</code> where <code>value</code> is a <code>string</code>.</td>
</tr>
</tbody>
</table>
<h2 id="supported-output-formats">Supported output formats<a class="headerlink" href="#supported-output-formats" title="Permanent link">&para;</a></h2>
<p>The following <code>output_format</code> tag values are supported by default:</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#env"><code>env</code></a></td>
<td>Metadata</td>
<td>Populates the context metadata ("environment") with values returned by the query.</td>
</tr>
<tr>
<td><a href="#csv"><code>csv</code></a></td>
<td>CSV</td>
<td>CSV format with column header row</td>
</tr>
<tr>
<td><a href="#json"><code>json</code></a></td>
<td>JSON</td>
<td>JSON Array of row objects.</td>
</tr>
<tr>
<td><a href="#jsons"><code>json-stream</code></a></td>
<td>"Streaming" JSON</td>
<td>Newline-delimited, multi-object JSON.</td>
</tr>
<tr>
<td><a href="#download"><code>download</code></a></td>
<td>Asset download</td>
<td>File assets referenced by URL are download to local storage relative to <code>output_path</code>.</td>
</tr>
<tr>
<td><a href="#fetch"><code>fetch</code></a></td>
<td>Asset reference</td>
<td><code>Bag</code>-based. File assets referenced by URL are assigned as remote file references via <code>fetch.txt</code>.</td>
</tr>
</tbody>
</table>
<h2 id="output-format-details">Output format details<a class="headerlink" href="#output-format-details" title="Permanent link">&para;</a></h2>
<p>Each <em>output format processor</em> is designed for a specific task, and the task types may vary for a given data export task.
Some <em>output formats</em> are designed to handle the export of tabular data from the catalog, while others are meant to handle the export of file assets that are referenced by tables in the catalog.
Other <em>output formats</em> may be implemented that could perform a combination of these tasks, implement a new format, or perform some kind of data transformation.</p>
<p><a name="env"></a></p>
<h3 id="env"><code>env</code><a class="headerlink" href="#env" title="Permanent link">&para;</a></h3>
<p>This <code>output_format</code> processor performs a catalog query in JSON mode and stores the key-value pairs of the <em>first</em> row of data returned into the metadata context or "working environment" for the download.
These key-value pairs can then be used as interpolation variables in subsequent stages of processing.</p>
<p><a name="csv"></a></p>
<h3 id="csv"><code>csv</code><a class="headerlink" href="#csv" title="Permanent link">&para;</a></h3>
<p>This <code>output_format</code> generates a standard Comma Separated Values formatted text file. The first row is a comma-delimited list of column names, and all subsequent rows are comma-delimted values.  Fields are not enclosed in quotation marks.</p>
<p>Example output:</p>
<pre><code>subject_id,sample_id,snp_id,gt,chipset
CNP0001_F09,600009963128,rs6265,0/1,HumanOmniExpress
CNP0002_F15,600018902293,rs6265,0/0,HumanOmniExpress
</code></pre>

<p><a name="json"></a></p>
<h3 id="json"><code>json</code><a class="headerlink" href="#json" title="Permanent link">&para;</a></h3>
<p>This <code>output_format</code> generates a text file containing a JSON Array of row data, where each JSON object in the array represents one row.</p>
<p>Example output:</p>
<pre><code class="json">[{&quot;subject_id&quot;:&quot;CNP0001_F09&quot;,&quot;sample_id&quot;:&quot;600009963128&quot;,&quot;snp_id&quot;:&quot;rs6265&quot;,&quot;gt&quot;:&quot;0/1&quot;,&quot;chipset&quot;:&quot;HumanOmniExpress&quot;},
 {&quot;subject_id&quot;:&quot;CNP0002_F15&quot;,&quot;sample_id&quot;:&quot;600018902293&quot;,&quot;snp_id&quot;:&quot;rs6265&quot;,&quot;gt&quot;:&quot;0/0&quot;,&quot;chipset&quot;:&quot;HumanOmniExpress&quot;}]
 ```

&lt;a name=&quot;jsons&quot;&gt;&lt;/a&gt;
### `json-stream`
This `output_format` generates a text file containing multiple lines of individual JSON objects terminated by the _newline_ line terminator `\n`. This
format is generally used when the result set is too prohibitively large to parse as a single JSON object and instead can be processed on a line-by-line basis.

Example output:
```json
{&quot;subject_id&quot;:&quot;CNP0001_F09&quot;,&quot;sample_id&quot;:&quot;600009963128&quot;,&quot;snp_id&quot;:&quot;rs6265&quot;,&quot;gt&quot;:&quot;0/1&quot;,&quot;chipset&quot;:&quot;HumanOmniExpress&quot;}
{&quot;subject_id&quot;:&quot;CNP0002_F15&quot;,&quot;sample_id&quot;:&quot;600018902293&quot;,&quot;snp_id&quot;:&quot;rs6265&quot;,&quot;gt&quot;:&quot;0/0&quot;,&quot;chipset&quot;:&quot;HumanOmniExpress&quot;}
</code></pre>

<p><a name="download"></a></p>
<h3 id="download"><code>download</code><a class="headerlink" href="#download" title="Permanent link">&para;</a></h3>
<p>This <code>output_format</code> processor performs multiple actions. First, it issues a <code>json-stream</code> catalog query against the specified <code>query_path</code>,
in order to generate a <em>file download manifest</em> file named <code>download-manifest.json</code>. This manifest is simply a set of rows which MUST contain at least one field named <code>url</code>, and MAY contain a field named <code>filename</code>,
and MAY contain other abritrary fields. If the <code>filename</code> field is present, it will be appended to the final (calculated) <code>output_path</code>, otherwise the application will perform a <em>HEAD</em> HTTP request against
the <code>url</code> for the <code>Content-Disposition</code> of the referenced file asset. If this query fails to determine the filename, the application falls back to using the final string component of the <code>url</code> field after the last <code>/</code> character.</p>
<p>If other fields are present, they are available for variable substitution in other parameters that support interpolation, e.g., <code>output_path</code>.</p>
<p>After the <em>file download manifest</em> is generated, the application attempts to download the files referenced in each <code>url</code> field to the local filesystem, storing them at the base relative path specified by <code>output_path</code>.</p>
<p>For example, the following configuration stanza:</p>
<pre><code class="json">{
  &quot;query_path&quot;: &quot;/attribute/D:=isa:dataset/accession={accession}/E:=isa:experiment/experiment_type:=isa:experiment_type/term=RNA%20expression%20%28RNA-seq%29/$E/STRAND:=vocabulary:strandedness/$E/R:=isa:replicate/SAMPLE:=isa:biosample/SPEC:=vocabulary:species/$R/SEQ:=isa:sequencing_data/PAIRED:=vocabulary:paired_end_or_single_read/$SEQ/file_format:=vocabulary:file_format/term=FastQ/$SEQ/dataset:=D:RID,experiment:=E:RID,biosample:=SAMPLE:RID,file:=SEQ:RID,filename:=SEQ:filename,size:=SEQ:byte_count,md5:=SEQ:md5,url:=SEQ:url&quot;,
  &quot;output_path&quot;: &quot;{dataset}/{experiment}/{biosample}/seq&quot;,
  &quot;output_format&quot;: &quot;download&quot;
}
</code></pre>

<p>Produces a <code>download-manifest.json</code> with rows like:</p>
<pre><code class="json">{
  &quot;dataset&quot;:13641,
  &quot;experiment&quot;:51203,
  &quot;biosample&quot;:50233,
  &quot;file&quot;:55121,
  &quot;filename&quot;:&quot;LPHW_111414_001A_e11.5_facebase_md_rna_R1.fastq.gz&quot;,
  &quot;size&quot;:2976697043,
  &quot;md5&quot;:&quot;9139b1626a35122fa85688cbb7ae6a8a&quot;,
  &quot;url&quot;:&quot;/hatrac/facebase/data/fb2/FB00000806.2/LPHW_111414_001A_e11.5_facebase_md_rna_R1.fastq.gz&quot;
}
</code></pre>

<p>After the <code>output_path</code> template string is interpolated with the values of the example row above, the file is then downloaded to the following relative path:</p>
<pre><code>./13641/51203/50233/seq/LPHW_111414_001A_e11.5_facebase_md_rna_R1.fastq.gz
</code></pre>

<p><a name="fetch"></a></p>
<h3 id="fetch"><code>fetch</code><a class="headerlink" href="#fetch" title="Permanent link">&para;</a></h3>
<p>This <code>output_format</code> processor performs multiple actions. First, it issues a <code>json-stream</code> catalog query against the specified <code>query_path</code>, in order to generate a  <em>file download manifest</em>.
This manifest is simply a set of rows which MUST contain at least one field named <code>url</code>, and SHOULD contain two additional fields: <code>length</code>,
which is the size of the referenced file in bytes, and (at least) one of the following <em>checksum</em> fields; <code>md5</code>, <code>sha1</code>, <code>sha256</code>, <code>sha512</code>. If the <em>length</em> and appropriate <em>checksum</em> fields are missing,
an attempt will be made to dynamically determine these fields from the remote <code>url</code> by issuing a <em>HEAD</em> HTTP request and parsing the result headers for the missing information.
If the required values cannot be determined this way, it is an error condition and the transfer will abort.</p>
<p>Similar to the <code>download</code> processor, the output of the catalog query MAY contain other fields. If the <code>filename</code> field is present, it will be appended to the final (calculated) <code>output_path</code>, otherwise the application will perform a <em>HEAD</em> HTTP request against
the <code>url</code> for the <code>Content-Disposition</code> of the referenced file asset. If this query fails to determine the filename, the application falls back to using the final name component of the <code>url</code> field after the last <code>/</code> character.
If other fields are present, they are also available for variable substitution in other parameters that support interpolation, e.g., <code>output_path</code>.</p>
<p>Unlike the <code>download</code> processor, the <code>fetch</code> processor does not actually download any asset files, but rather uses the query results to create a <code>bag</code> with checksummed manifest entries that reference each remote asset via the <code>bag</code>'s <code>fetch.txt</code> file.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../deriva-hatrac-cli/" class="btn btn-neutral float-right" title="Interact with Hatrac object store (deriva-hatrac-cli)">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../install/" class="btn btn-neutral" title="Installing deriva-py"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2018 <a href="http://github.com/informatics-isi-edu/deriva-py">deriva-py Project</a>.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../install/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../deriva-hatrac-cli/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
